<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>l22leastsquares – Geometric Algorithms</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./L22LeastSquares.html">Least Squares</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/DiagramAR-icon.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./landing_page.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L01LinearEquations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Equations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L02Numerics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">(Getting Serious About) Numbers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L03RowReductions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Elimination</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L04VectorEquations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vector Equations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L05Axb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="math inline">\(A\mathbf{x} = \mathbf{b}\)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L06LinearIndependence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Independence</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L07LinearTransformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Transformations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L08MatrixofLinearTransformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Matrix of a Linear Transformation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L09MatrixOperations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Matrix Algebra</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L10MatrixInverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Inverse of a Matrix</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L11MarkovChains.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Markov Chains</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L12MatrixFactorizations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Matrix Factorizations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L13ComputerGraphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computer Graphics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L14Subspaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Subspaces</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L15DimensionRank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dimension and Rank</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L16Eigenvectors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Eigenvectors and Eigenvalues</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L17CharacteristicEqn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Characteristic Equation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L18Diagonalization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diagonalization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L19PageRank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PageRank</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L20Orthogonality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analytic Geometry in <span class="math inline">\(\mathbb{R}^n\)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L21OrthogonalSets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Orthogonal Sets and Projection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L22LeastSquares.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Least Squares</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L23LinearModels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L24SymmetricMatrices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Symmetric Matrices</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L25SVD.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Singular Value Decomposition</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./L26ApplicationsOfSVD.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Applications of the SVD</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./postscript.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Postscript</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#least-squares" id="toc-least-squares" class="nav-link active" data-scroll-target="#least-squares">Least Squares</a></li>
  <li><a href="#when-an-inconsistent-system-is-better-than-a-consistent-system" id="toc-when-an-inconsistent-system-is-better-than-a-consistent-system" class="nav-link" data-scroll-target="#when-an-inconsistent-system-is-better-than-a-consistent-system">When an Inconsistent System is Better than a Consistent System</a>
  <ul class="collapse">
  <li><a href="#finding-a-good-approximate-solution" id="toc-finding-a-good-approximate-solution" class="nav-link" data-scroll-target="#finding-a-good-approximate-solution">Finding a Good <em>Approximate</em> Solution</a></li>
  </ul></li>
  <li><a href="#the-general-least-squares-problem" id="toc-the-general-least-squares-problem" class="nav-link" data-scroll-target="#the-general-least-squares-problem">The General Least-Squares Problem</a>
  <ul class="collapse">
  <li><a href="#interpretation-of-the-least-squares-problem" id="toc-interpretation-of-the-least-squares-problem" class="nav-link" data-scroll-target="#interpretation-of-the-least-squares-problem">Interpretation of the Least Squares Problem</a></li>
  </ul></li>
  <li><a href="#solving-the-general-least-squares-problem" id="toc-solving-the-general-least-squares-problem" class="nav-link" data-scroll-target="#solving-the-general-least-squares-problem">Solving the General Least Squares Problem</a>
  <ul class="collapse">
  <li><a href="#the-orthogonal-decomposition-theorem" id="toc-the-orthogonal-decomposition-theorem" class="nav-link" data-scroll-target="#the-orthogonal-decomposition-theorem">The Orthogonal Decomposition Theorem</a></li>
  <li><a href="#the-best-approximation-theorem" id="toc-the-best-approximation-theorem" class="nav-link" data-scroll-target="#the-best-approximation-theorem">The Best Approximation Theorem</a></li>
  </ul></li>
  <li><a href="#orthogonal-projection-solves-least-squares" id="toc-orthogonal-projection-solves-least-squares" class="nav-link" data-scroll-target="#orthogonal-projection-solves-least-squares">Orthogonal Projection Solves Least Squares</a>
  <ul class="collapse">
  <li><a href="#the-normal-equations" id="toc-the-normal-equations" class="nav-link" data-scroll-target="#the-normal-equations">The Normal Equations</a></li>
  <li><a href="#when-the-normal-equations-have-multiple-solutions" id="toc-when-the-normal-equations-have-multiple-solutions" class="nav-link" data-scroll-target="#when-the-normal-equations-have-multiple-solutions">When the Normal Equations have Multiple Solutions</a></li>
  <li><a href="#projection-onto-an-abitrary-basis" id="toc-projection-onto-an-abitrary-basis" class="nav-link" data-scroll-target="#projection-onto-an-abitrary-basis">Projection onto an Abitrary Basis</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">




<!--
This comment somehow suppresses the title page
-->
<section id="least-squares" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="least-squares">Least Squares</h2>

<div class="no-row-height column-margin column-container"><div class="">
<p>Ceres image credit: <a href="Justin Cowart, Public domain, via Wikimedia Commons">https://commons.wikimedia.org/wiki/File:Ceres_-<em>RC3</em>-<em>Haulani_Crater</em>(22381131691)_(cropped).jpg</a></p>
<p>Good additional reading on Gauss’s use of Least Squares and determination of the orbit of Ceres is <a href="https://www.actuaries.digital/2021/03/31/gauss-least-squares-and-the-missing-planet/">here</a>.</p>
</div></div><div class="columns">
<div class="column" style="width:40%;">
<p><img src="images/Carl_Friedrich_Gauss.jpg" alt="Carl F. Gauss" height="350"></p>
</div><div class="column" style="width:50%;">
<p><img src="images/Ceres_-_RC3_-_Haulani_Crater_(22381131691)_(cropped).jpg" alt="The Dwarf Planet Ceres" height="350"></p>
</div>
</div>
<div class="fragment">
<p>Let’s go back to week 1. A long time ago!</p>
<p>Recall Gauss’s remarkable accomplishment in his early 20s. He took the set of measurements made by Piazzi of the dwarf planet Ceres and predicted where Ceres subsequently would appear in the sky (after it was lost behind the sun). This told Olbers exactly where to look, and lo and behold . . .</p>
</div>
<p>We can understand now a little better what Gauss had to do.</p>
<p>Kepler had discovered, and Newton had explained, that each planet orbits the sun following the path of an ellipse.</p>
<div class="fragment">
<p>To describe the orbit of Ceres, Gauss had to construct the equation for its ellipse:</p>
<p><span class="math display">\[a_1 x_1^2 + a_2 x_2^2 + a_3 x_1x_2 + a_4 x_1 + a_5 x_2 + a_6 = 0.\]</span></p>
</div>
<div class="fragment">
<p>He had many measurements of <span class="math inline">\((x_1, x_2)\)</span> pairs and had to find the <span class="math inline">\(a_1, \dots, a_6.\)</span></p>
</div>
<div class="fragment">
<p>This is actually a linear system:</p>
<p><span class="math display">\[\begin{bmatrix}x_{11}^2 &amp;x_{21}^2&amp;x_{11}x_{21}&amp;x_{11}&amp;x_{21}&amp;1\\x_{12}^2 &amp;x_{22}^2&amp;x_{12}x_{22}&amp;x_{12}&amp;x_{22}&amp;1\\
\vdots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\vdots&amp;\vdots\\x_{1n}^2 &amp;x_{2n}^2&amp;x_{1n}x_{2n}&amp;x_{1n}&amp;x_{2n}&amp;1\end{bmatrix} \begin{bmatrix}a_1\\a_2\\a_3\\a_4\\a_5\\a_6\end{bmatrix} = \mathbf{0}\]</span></p>
</div>
<div class="fragment">
<p>Now, according to Newton, this is a consistent linear system.</p>
<p>The equation for the ellipse is exactly correct and all we need is six <span class="math inline">\((x_1, x_2)\)</span> sets of measurements to know the orbit of Ceres exactly.</p>
</div>
<div class="fragment">
<p>What could go wrong? :)</p>
</div>
<div class="fragment">
<p>Obviously, there are going to be measurement errors in Piazzi’s observations.</p>
<p>If we just solve the system using six measurements, we will probably get incorrect values for the coefficients <span class="math inline">\(a_1, \dots, a_6.\)</span></p>
</div>
</section>
<section id="when-an-inconsistent-system-is-better-than-a-consistent-system" class="level2">
<h2 class="anchored" data-anchor-id="when-an-inconsistent-system-is-better-than-a-consistent-system">When an Inconsistent System is Better than a Consistent System</h2>
<div class="fragment">
<p>Notice that each time Piazzi takes a measurement of the position of Ceres, we add an additional equation to our linear system.</p>
<p>Just using six measurements will certainly result in incorrect coefficients due to measurement error.</p>
</div>
<div class="fragment">
<p>A better idea is to use all of the <span class="math inline">\(n\)</span> measurement data available, and try to find a way to cancel out errors.</p>
<p>So, using all the <span class="math inline">\(n\)</span> data measurements available, we construct a linear system:</p>
<p><span class="math display">\[ X\mathbf{a} = \mathbf{b}\]</span></p>
<p>where <span class="math inline">\(X\)</span> is <span class="math inline">\(n\times 6\)</span> and <span class="math inline">\(\mathbf{b} \in \mathbb{R}^n\)</span>.</p>
</div>
<div class="fragment">
<p>But now, due to measurement errors, we can’t expect <span class="math inline">\(\mathbf{b}\)</span> will lie in the column space of <span class="math inline">\(X.\)</span> We have an inconsistent system.</p>
<p>This system has <strong>no solutions!</strong></p>
</div>
<div class="fragment">
<p>What can we do if <span class="math inline">\(A\mathbf{x} = \mathbf{b}\)</span> has <strong>no solutions?</strong></p>
</div>
<div class="fragment">
<p>Here is the key idea: the fact that our measurements include errors does not make our measurements worthless!</p>
<p>We simply need a principled approach to doing the best job we can given the errors in our measurements.</p>
<p>Let’s see how we can do that.</p>
</div>
<p>We now understand if <span class="math inline">\(A\)</span> is <span class="math inline">\(m\times n\)</span> and <span class="math inline">\(A\mathbf{x} = \mathbf{b}\)</span> has no solutions, that is because</p>
<ul>
<li>the columns of <span class="math inline">\(A\)</span> do not span <span class="math inline">\(\mathbb{R}^m\)</span>, and</li>
<li><span class="math inline">\(\mathbf{b}\)</span> is not in the column space of <span class="math inline">\(A\)</span>.</li>
</ul>
<div class="fragment">
<p>Here is an example we can visualize, in which <span class="math inline">\(A\)</span> is <span class="math inline">\(3 \times 2\)</span>:</p>
<div class="ctrd">
<div id="ded65cac" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-3-output-1.png" width="463" height="520" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="fragment">
<p>For the problem of Ceres’ orbit, the reason that <span class="math inline">\(\mathbf{b}\)</span> does not lie in <span class="math inline">\(\operatorname{Col} A\)</span> is due to <strong>measurement error.</strong></p>
</div>
<section id="finding-a-good-approximate-solution" class="level3">
<h3 class="anchored" data-anchor-id="finding-a-good-approximate-solution">Finding a Good <em>Approximate</em> Solution</h3>
<div class="fragment">
<p>If we make the assumption that measurement errors are small, then we should be quite satisfied to find an <span class="math inline">\(\mathbf{x}\)</span> that makes <span class="math inline">\(A\mathbf{x}\)</span> as close as possible to <span class="math inline">\(\mathbf{b}.\)</span></p>
</div>
<div class="fragment">
<p>In other words, we are looking for an <span class="math inline">\(\mathbf{x}\)</span> such that <span class="math inline">\(A\mathbf{x}\)</span> makes a good <strong>approximation</strong> to <span class="math inline">\(\mathbf{b}.\)</span></p>
</div>
<div class="fragment">
<div class="ctrd">
<div id="cc98a025" class="cell" data-execution_count="3">
<div class="cell-output cell-output-stderr">
<pre><code>&lt;&gt;:31: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:31: SyntaxWarning: invalid escape sequence '\m'
/var/folders/y0/f8_7klyx3sjbkw2pj03bnj040000gn/T/ipykernel_5591/1816056809.py:31: SyntaxWarning: invalid escape sequence '\m'
  'We should be happy with an $\mathbf{x} such that AX is close to b', size = 16)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-4-output-2.png" width="607" height="520" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>We can think of the <font color="blue">error of the approximation</font> of <span class="math inline">\(A\mathbf{x}\)</span> to <span class="math inline">\(\mathbf{b}\)</span> as the <font color="blue">distance</font> from <span class="math inline">\(A\mathbf{x}\)</span> to <span class="math inline">\(\mathbf{b},\)</span> which is</p>
<p><span class="math display">\[\Vert A\mathbf{x} - \mathbf{b}\Vert.\]</span></p>
<div class="ctrd">
<div id="c60e490d" class="cell" data-execution_count="4">
<div class="cell-output cell-output-stderr">
<pre><code>&lt;&gt;:31: SyntaxWarning: invalid escape sequence '\m'
&lt;&gt;:31: SyntaxWarning: invalid escape sequence '\m'
/var/folders/y0/f8_7klyx3sjbkw2pj03bnj040000gn/T/ipykernel_5591/1816056809.py:31: SyntaxWarning: invalid escape sequence '\m'
  'We should be happy with an $\mathbf{x} such that AX is close to b', size = 16)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-5-output-2.png" width="607" height="520" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="the-general-least-squares-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-general-least-squares-problem">The General Least-Squares Problem</h2>
<p>We can now formally express what we are looking for when we seek a “good” solution to an inconsistent system:</p>
<p>The <strong>general least-squares problem</strong> is to find an <span class="math inline">\(\mathbf{x}\)</span> that makes <span class="math inline">\(\Vert A\mathbf{x}-\mathbf{b}\Vert\)</span> as small as possible.</p>
<div class="fragment">
<p>This is called “least squares” because it is equivalent to minimizing <span class="math inline">\(\Vert A\mathbf{x}-\mathbf{b}\Vert^2,\)</span> which is the sum of squared differences.</p>
</div>
<p>To make this correspondence explicit: say that we denote <span class="math inline">\(A\mathbf{x}\)</span> by <span class="math inline">\(\mathbf{y}\)</span>. Then</p>
<p><span class="math display">\[\Vert A\mathbf{x}-\mathbf{b}\Vert^2 = \Vert \mathbf{y}-\mathbf{b}\Vert^2 = \sum_i (y_i-b_i)^2\]</span></p>
<p>Where we interpret <span class="math inline">\(y_i\)</span> as the <em>estimated value</em> and <span class="math inline">\(b_i\)</span> as the <em>measured value.</em></p>
<p>So this expression is the <strong>sum of squared error.</strong></p>
<p>This is the most common measure of error used in statistics.</p>
<div class="fragment">
<p>This is a key principle!</p>
<p>Minimizing the <font color="blue">length</font> of <span class="math inline">\(A\mathbf{x} - \mathbf{b}\)</span> is the same as minimizing the <font color="blue">sum of squared error.</font></p>
<div class="ctrd">
<div id="c13e56ba" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-6-output-1.png" width="315" height="315" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><strong>Definition.</strong> If A is <span class="math inline">\(m\times n\)</span> and <span class="math inline">\(\mathbf{b}\)</span> is in <span class="math inline">\(\mathbb{R}^m,\)</span> a <strong>least squares solution</strong> of <span class="math inline">\(A\mathbf{x} =\mathbf{b}\)</span> is an <span class="math inline">\(\mathbf{\hat{x}}\)</span> in <span class="math inline">\(\mathbb{R}^n\)</span> such that</p>
<p><span class="math display">\[\Vert A\mathbf{\hat{x}} - \mathbf{b}\Vert \leq \Vert A\mathbf{x} - \mathbf{b}\Vert\]</span></p>
<p>for all <span class="math inline">\(\mathbf{x}\)</span> in <span class="math inline">\(\mathbb{R}^n\)</span>.</p>
<div class="fragment">
<p>An equivalent (and more common) way to express this is:</p>
<p><span class="math display">\[\hat{\mathbf{x}} = \arg\min_\mathbf{x} \Vert A\mathbf{x} - \mathbf{b}\Vert.\]</span></p>
<p>which emphasizes that this is a minimization problem, also called an <em>optimization</em> problem.</p>
</div>
<section id="interpretation-of-the-least-squares-problem" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-the-least-squares-problem">Interpretation of the Least Squares Problem</h3>
<div class="fragment">
<p>The point here is that no matter what <span class="math inline">\(\mathbf{x}\)</span> is, <span class="math inline">\(A\mathbf{x}\)</span> will be in the column space of <span class="math inline">\(A\)</span> — that is, <span class="math inline">\(\operatorname{Col}A\)</span>.</p>
<p>So in our problem,</p>
<ul>
<li><span class="math inline">\(\mathbf{b}\)</span> is outside <span class="math inline">\(\operatorname{Col}A\)</span>, and</li>
<li>we are looking for <span class="math inline">\(\hat{\mathbf{x}}\)</span>,</li>
<li>which specifies the closest point in <span class="math inline">\(\operatorname{Col}A\)</span> to <span class="math inline">\(\mathbf{b}\)</span>.</li>
</ul>
</div>
<div class="fragment">
<div class="ctrd">
<div id="0222efe8" class="cell" data-execution_count="6">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-7-output-1.png" width="389" height="389" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="fragment">
<p>The vector <span class="math inline">\(\mathbf{b}\)</span> is closer to <span class="math inline">\(A\mathbf{\hat{x}}\)</span> than it is to <span class="math inline">\(A\mathbf{x}\)</span> for any other <span class="math inline">\(\mathbf{x}\)</span>.</p>
<p>For example, the red points in the figure are both further from <span class="math inline">\(\mathbf{b}\)</span> than is <span class="math inline">\(A\mathbf{\hat{x}}\)</span>.</p>
</div>
</section>
</section>
<section id="solving-the-general-least-squares-problem" class="level2">
<h2 class="anchored" data-anchor-id="solving-the-general-least-squares-problem">Solving the General Least Squares Problem</h2>
<div class="fragment">
<p>In order to solve the Least Squares problem, we need to bring in a bit more theory.</p>
<p>All we need to do is to extend some of the ideas we developed in the last lecture.</p>
<p>The last lecture developed methods for finding the point in a 1D subspace that is closest to a given point.</p>
</div>
<div class="fragment">
<p>We need to generalize the idea of “closest point” to the case of an <strong>arbitrary</strong> subspace.</p>
<p>This leads to two theorems: the <strong>Orthogonal Decomposition Theorem</strong> and the <strong>Best Approximation Theorem.</strong></p>
</div>
<section id="the-orthogonal-decomposition-theorem" class="level3">
<h3 class="anchored" data-anchor-id="the-orthogonal-decomposition-theorem">The Orthogonal Decomposition Theorem</h3>
<div class="fragment">
<p>Let <span class="math inline">\(W\)</span> be a subspace of <span class="math inline">\(\mathbb{R}^n\)</span>. Then each <span class="math inline">\(\mathbf{y}\)</span> in <span class="math inline">\(\mathbb{R}^n\)</span> can be written <strong>uniquely</strong> in the form</p>
<p><span class="math display">\[ \mathbf{y} = \hat{\mathbf{y}} + \mathbf{z}\]</span></p>
<p>where <span class="math inline">\(\hat{\mathbf{y}}\)</span> is in <span class="math inline">\(W\)</span> and <span class="math inline">\(\mathbf{z}\)</span> is orthogonal to every vector in <span class="math inline">\(W\)</span>.</p>
</div>
<div class="fragment">
<div class="ctrd">
<div id="56acb042" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-8-output-1.png" width="474" height="343" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="fragment">
<div class="ctrd">
<div id="6b7c73da" class="cell" data-execution_count="8">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-9-output-1.png" width="481" height="520" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="fragment">
<p><strong>Proof.</strong> (straightforward extension of the 1D case from last lecture.)</p>
<p>Just as in the case of a 1D subspace (in the last lecture), we say that <span class="math inline">\(\hat{\mathbf{y}}\)</span> is the <strong>orthogonal projection of <span class="math inline">\(\mathbf{y}\)</span> onto <span class="math inline">\(W\)</span></strong> and write <span class="math inline">\(\hat{\mathbf{y}} = \operatorname{proj}_W\mathbf{y}.\)</span></p>
</div>
</section>
<section id="the-best-approximation-theorem" class="level3">
<h3 class="anchored" data-anchor-id="the-best-approximation-theorem">The Best Approximation Theorem</h3>
<div class="fragment">
<p>Let <span class="math inline">\(W\)</span> be a subspace of <span class="math inline">\(\mathbb{R}^n\)</span>, let <span class="math inline">\(\mathbf{y}\)</span> be any vector in <span class="math inline">\(\mathbb{R}^n\)</span>, and let <span class="math inline">\(\hat{\mathbf{y}}\)</span> be the orthogonal projection of <span class="math inline">\(\mathbf{y}\)</span> onto <span class="math inline">\(W\)</span>. Then <span class="math inline">\(\hat{\mathbf{y}}\)</span> is the closest point in <span class="math inline">\(W\)</span> to <span class="math inline">\(\mathbf{y}\)</span>, in the sense that</p>
<p><span class="math display">\[\Vert \mathbf{y}-\hat{\mathbf{y}} \Vert &lt; \Vert \mathbf{y} - \mathbf{v} \Vert\]</span></p>
<p>for all <span class="math inline">\(\mathbf{v}\)</span> in <span class="math inline">\(W\)</span> distinct from <span class="math inline">\(\hat{\mathbf{y}}\)</span>.</p>
</div>
<div class="fragment">
<p><strong>Proof.</strong></p>
<p>Take <span class="math inline">\(\mathbf{v}\)</span> in <span class="math inline">\(W\)</span> distinct from <span class="math inline">\(\hat{\mathbf{y}}\)</span>. Here is what the setup looks like:</p>
<div class="ctrd">
<div id="3ea40a1a" class="cell" data-execution_count="9">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-10-output-1.png" width="481" height="520" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="fragment">
<p>Both <span class="math inline">\(\hat{\mathbf{y}}\)</span> and <span class="math inline">\(\mathbf{v}\)</span> are in <span class="math inline">\(W\)</span>, so <span class="math inline">\(\hat{\mathbf{y}} - \mathbf{v}\)</span> is in <span class="math inline">\(W\)</span>.</p>
</div>
<div class="fragment">
<p>By the orthogonal decomposition theorem, <span class="math inline">\(\mathbf{y} - \hat{\mathbf{y}}\)</span> is orthogonal to every vector in <span class="math inline">\(W\)</span>, so it is orthogonal to <span class="math inline">\(\hat{\mathbf{y}} - \mathbf{v}.\)</span></p>
</div>
<div class="fragment">
<p>Now, these three points form a right triangle because</p>
<p><span class="math display">\[ \mathbf{y} - \mathbf{v} = (\mathbf{y} - \hat{\mathbf{y}}) + (\hat{\mathbf{y}} - \mathbf{v}). \]</span></p>
</div>
<div class="fragment">
<p>So the Pythagorean Theorem tells us that</p>
<p><span class="math display">\[ \Vert\mathbf{y} - \mathbf{v}\Vert^2 = \Vert\mathbf{y} - \hat{\mathbf{y}}\Vert^2 + \Vert\hat{\mathbf{y}} - \mathbf{v}\Vert^2. \]</span></p>
</div>
<div class="fragment">
<p>Now <span class="math inline">\(\hat{\mathbf{y}} - \mathbf{v} \neq {\bf 0}\)</span> because <span class="math inline">\(\mathbf{y}\)</span> is distinct from <span class="math inline">\(\mathbf{v}\)</span>.</p>
</div>
<div class="fragment">
<p>So</p>
<p><span class="math display">\[\Vert \hat{\mathbf{y}} - \mathbf{v} \Vert &gt; 0.\]</span></p>
</div>
<div class="fragment">
<p>So</p>
<p><span class="math display">\[ \Vert\mathbf{y} - \mathbf{v}\Vert^2 &gt; \Vert\mathbf{y} - \hat{\mathbf{y}}\Vert^2. \]</span></p>
</div>
<div class="fragment">
<p>So we have shown a key fact:</p>
<p><span class="math display">\[ \operatorname{Proj}_W \mathbf{y} \text{ is the closest point in } W \text{ to } \mathbf{y}.\]</span></p>
</div>
</section>
</section>
<section id="orthogonal-projection-solves-least-squares" class="level2">
<h2 class="anchored" data-anchor-id="orthogonal-projection-solves-least-squares">Orthogonal Projection Solves Least Squares</h2>
<p>Let’s apply these ideas to solving the least squares problem.</p>
<div class="fragment">
<p>Here is what we want to achieve:</p>
<p><span class="math display">\[\hat{\mathbf{x}} = \arg\min_\mathbf{x} \Vert A\mathbf{x} - \mathbf{b}\Vert.\]</span></p>
<p>That is, we want <span class="math inline">\(A\hat{\mathbf{x}}\)</span> to be the closest point in <span class="math inline">\(\operatorname{Col}A\)</span> to <span class="math inline">\(\mathbf{b}\)</span>.</p>
</div>
<div class="fragment">
<p>… and we now know that the closest point to <span class="math inline">\(\mathbf{b}\)</span> in a subspace <span class="math inline">\(W\)</span> is the <strong>projection</strong> of <span class="math inline">\(\mathbf{b}\)</span> onto <span class="math inline">\(W.\)</span></p>
</div>
<div class="fragment">
<p>So the point we are looking for, which we’ll call <span class="math inline">\(\hat{\mathbf{b}},\)</span> is:</p>
<p><span class="math display">\[\hat{\mathbf{b}} = \operatorname{proj}_{\operatorname{Col}A} \mathbf{b}\]</span></p>
</div>
<div class="fragment">
<p>The key is that <span class="math inline">\(\hat{\mathbf{b}}\)</span> <strong>is</strong> in the column space of <span class="math inline">\(A\)</span>. So this equation is consistent, and we can solve it:</p>
<p><span class="math display">\[A\mathbf{\hat{x}} = \hat{\mathbf{b}}.\]</span></p>
</div>
<div class="fragment">
<div class="ctrd">
<div id="f8cd0a38" class="cell" data-execution_count="10">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-11-output-1.png" width="543" height="520" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="fragment">
<p>Since <span class="math inline">\(\hat{\mathbf{b}}\)</span> is the closest point in <span class="math inline">\(\operatorname{Col}A\)</span> to <span class="math inline">\(\mathbf{b},\)</span> a vector <span class="math inline">\(\hat{\mathbf{x}}\)</span> is a least-squares solution of <span class="math inline">\(A\mathbf{x}=\mathbf{b}\)</span> if and only if <span class="math inline">\(\mathbf{\hat{x}}\)</span> satisfies <span class="math inline">\(A\mathbf{\hat{x}} = \hat{\mathbf{b}}.\)</span></p>
</div>
<!--- Commenting this out for now, because it is a bit too much complexity
::: {.fragment}
(Note: we know that $A\mathbf{\hat{x}} =\hat{\mathbf{b}}$ is consistent (by definition), so there exists at least one solution.  

However note that if $A$ has free variables -- the columns of $A$ are not independent -- then there would be many solutions of $A\mathbf{\hat{x}} =\hat{\mathbf{b}}$.) 
:::
-->
<p>Let’s go back to the case that we can visualize.</p>
<div class="fragment">
<p><span class="math inline">\(A\)</span> is <span class="math inline">\(3 \times 2.\)</span></p>
<p>We have only two columns <span class="math inline">\(\mathbf{a}_1\)</span> and <span class="math inline">\(\mathbf{a}_2\)</span> so they cannot span <span class="math inline">\(\mathbb{R}^3\)</span>.</p>
<p>So <span class="math inline">\(\mathbf{b}\)</span> may not lie in <span class="math inline">\(\operatorname{Col}A\)</span>, and in our example it does not:</p>
<div class="ctrd">
<div id="2c23edce" class="cell" data-execution_count="11">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-12-output-1.png" width="481" height="520" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="fragment">
<p>And what we want to find is the projection of <span class="math inline">\(\mathbf{b}\)</span> onto the column space of <span class="math inline">\(A\)</span>:</p>
<div class="ctrd">
<div id="4b9d8a68" class="cell" data-execution_count="12">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-13-output-1.png" width="481" height="520" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<section id="the-normal-equations" class="level3">
<h3 class="anchored" data-anchor-id="the-normal-equations">The Normal Equations</h3>
<p>So: how are we going to find this projection <span class="math inline">\(\hat{\mathbf{b}}\)</span>?</p>
<div class="fragment">
<p>Here is the key idea:</p>
<p>We know that the projection <span class="math inline">\(\hat{\mathbf{b}}\)</span> has the property that <span class="math inline">\(\hat{\mathbf{b}}-\mathbf{b}\)</span> is orthogonal to <span class="math inline">\(\operatorname{Col}A.\)</span></p>
</div>
<div class="fragment">
<p>Suppose <span class="math inline">\(\hat{\mathbf{b}}\)</span> is <span class="math inline">\(\operatorname{proj}_{\operatorname{Col}A}\mathbf{b},\)</span> and that <span class="math inline">\(\mathbf{\hat{x}}\)</span> satisfies <span class="math inline">\(A\mathbf{\hat{x}} = \hat{\mathbf{b}}\)</span>.</p>
<p>So <span class="math inline">\(A\mathbf{\hat{x}} - \mathbf{b}\)</span> is orthogonal to each column of <span class="math inline">\(A\)</span>.</p>
</div>
<div class="fragment">
<p>If <span class="math inline">\(\mathbf{a}_j\)</span> is any column of <span class="math inline">\(A\)</span>, then</p>
<p><span class="math display">\[\mathbf{a}_j^T(A\mathbf{\hat{x}} - \mathbf{b}) = 0.\]</span></p>
</div>
<div class="fragment">
<p>Now, each <span class="math inline">\(\mathbf{a}_j^T\)</span> is a row of <span class="math inline">\(A^T\)</span>.</p>
<p>We can collect all of the equations for all the <span class="math inline">\(\mathbf{a}_j\)</span> as:</p>
<p><span class="math display">\[A^T(A\mathbf{\hat{x}} - \mathbf{b}) = {\bf 0}.\]</span></p>
</div>
<div class="fragment">
<p>So</p>
<p><span class="math display">\[A^TA\mathbf{\hat{x}} - A^T\mathbf{b} = {\bf 0}\]</span></p>
</div>
<div class="fragment">
<p>So</p>
<p><span class="math display">\[A^TA\mathbf{\hat{x}} = A^T\mathbf{b}\]</span></p>
</div>
<div class="fragment">
<p>Looking at this, we see that <span class="math inline">\(A^T\mathbf{b}\)</span> is a vector, and <span class="math inline">\(A^TA\)</span> is a matrix, so this is a standard linear system.</p>
</div>
<div class="fragment">
<p>This linear system is called the <strong>normal equations</strong> for <span class="math inline">\(A\mathbf{x} = \mathbf{b}.\)</span></p>
<p>Its solution is usually denoted <span class="math inline">\(\mathbf{\hat{x}}\)</span>.</p>
</div>
<p><strong>Theorem.</strong> The set of least-squares solutions of <span class="math inline">\(A\mathbf{x} = \mathbf{b}\)</span> is equal to the (nonempty) set of solutions of the normal equations <span class="math inline">\(A^TA\mathbf{x} = A^T\mathbf{b}.\)</span></p>
<div class="fragment">
<p><strong>Proof.</strong></p>
<p>&nbsp; (1) The set of solutions is nonempty. The matrix on the left has the same column space as <span class="math inline">\(A^T\)</span> and the vector on the right is a vector in the column space of <span class="math inline">\(A^T.\)</span></p>
<p>And, by the arguments above, any least-squares solution of <span class="math inline">\(A\mathbf{x} = \mathbf{b}\)</span> must satisfy the normal equations <span class="math inline">\(A^TA\mathbf{x} = A^T\mathbf{b}.\)</span></p>
</div>
<div class="fragment">
<p>&nbsp; (2) Now let’s show that any solution of <span class="math inline">\(A^TA\mathbf{x} = A^T\mathbf{b}\)</span> is a least squares solution of <span class="math inline">\(A\mathbf{x} = \mathbf{b}\)</span>.</p>
<p>If <span class="math inline">\(\mathbf{\hat{x}}\)</span> satisfies <span class="math inline">\(A^TA\mathbf{x} = A^T\mathbf{b},\)</span> then <span class="math inline">\(A^T(A\mathbf{\hat{x}} -\mathbf{b}) = {\bf 0},\)</span></p>
</div>
<div class="fragment">
<p>which shows that <span class="math inline">\(A\mathbf{\hat{x}} - \mathbf{b}\)</span> is orthogonal to the rows of <span class="math inline">\(A^T,\)</span> and so is orthogonal to the columns of <span class="math inline">\(A\)</span>.</p>
</div>
<div class="fragment">
<p>So the vector <span class="math inline">\(A\mathbf{\hat{x}} - \mathbf{b}\)</span> is orthogonal to <span class="math inline">\(\operatorname{Col}A\)</span>.</p>
</div>
<div class="fragment">
<p>So the equation</p>
<p><span class="math display">\[\mathbf{b} = A\mathbf{\hat{x}} + (\mathbf{b} - A\mathbf{\hat{x}})\]</span></p>
<p>is a decomposition of <span class="math inline">\(\mathbf{b}\)</span> into the sum of a vector in <span class="math inline">\(\operatorname{Col}A\)</span> and a vector orthogonal to <span class="math inline">\(\operatorname{Col}A\)</span>.</p>
</div>
<div class="fragment">
<p>Since the orthogonal decomposition is unique, <span class="math inline">\(A\mathbf{\hat{x}}\)</span> must be the orthogonal projection of <span class="math inline">\(\mathbf{b}\)</span> onto the column space of <span class="math inline">\(A\)</span>.</p>
<p>So <span class="math inline">\(A\mathbf{\hat{x}} = \hat{\mathbf{b}}\)</span> and <span class="math inline">\(\mathbf{\hat{x}}\)</span> is a least-squares solution.</p>
</div>
<p><strong>Example.</strong> Find the least squares solution of the inconsistent system <span class="math inline">\(A\mathbf{x} = \mathbf{b}\)</span> for</p>
<p><span class="math display">\[A = \begin{bmatrix}4&amp;0\\0&amp;2\\1&amp;1\end{bmatrix}, \;\;\; \mathbf{b} = \begin{bmatrix}2\\0\\11\end{bmatrix}.\]</span></p>
<div class="fragment">
<p><strong>Solution.</strong></p>
<p>We will use the normal equations <span class="math inline">\(A^TA\hat{\mathbf{x}} = A^T\mathbf{b}.\)</span></p>
<p><span class="math display">\[A^TA = \begin{bmatrix}4&amp;0&amp;1\\0&amp;2&amp;1\end{bmatrix} \begin{bmatrix}4&amp;0\\0&amp;2\\1&amp;1\end{bmatrix} = \begin{bmatrix}17&amp;1\\1&amp;5\end{bmatrix}\]</span></p>
<p><span class="math display">\[A^T\mathbf{b} =  \begin{bmatrix}4&amp;0&amp;1\\0&amp;2&amp;1\end{bmatrix} \begin{bmatrix}2\\0\\11\end{bmatrix} = \begin{bmatrix}19\\11\end{bmatrix}\]</span></p>
</div>
<div class="fragment">
<p>So the normal equations are:</p>
<p><span class="math display">\[ \begin{bmatrix}17&amp;1\\1&amp;5\end{bmatrix}\begin{bmatrix}\hat{x}_1\\\hat{x}_2\end{bmatrix} = \begin{bmatrix}19\\11\end{bmatrix}\]</span></p>
</div>
<div class="fragment">
<p>We can solve this using row operations, or by inverting <span class="math inline">\(A^TA\)</span> (if it is invertible).</p>
<p><span class="math display">\[(A^TA)^{-1} = \frac{1}{84}\begin{bmatrix}5&amp;-1\\-1&amp;17\end{bmatrix}\]</span></p>
</div>
<div class="fragment">
<p>Since <span class="math inline">\(A^TA\)</span> is invertible, we can then solve <span class="math inline">\(A^TA\hat{\mathbf{x}} = A^T\mathbf{b}\)</span> as</p>
<p><span class="math display">\[\mathbf{\hat{x}} = (A^TA)^{-1}A^T\mathbf{b}\]</span></p>
</div>
<div class="fragment">
<p><span class="math display">\[ = \frac{1}{84}\begin{bmatrix}5&amp;-1\\-1&amp;17\end{bmatrix}\begin{bmatrix}19\\11\end{bmatrix} = \frac{1}{84}\begin{bmatrix}84\\168\end{bmatrix} = \begin{bmatrix}1\\2\end{bmatrix}.\]</span></p>
<p>So we conclude that <span class="math inline">\(\mathbf{\hat{x}} = \begin{bmatrix}1\\2\end{bmatrix}\)</span> is the vector that minimizes <span class="math inline">\(\Vert A\mathbf{x} -\mathbf{b}\Vert.\)</span></p>
</div>
<div class="fragment">
<p>More formally,</p>
<p><span class="math display">\[\mathbf{\hat{x}} = \arg\min_{\mathbf{x}} \Vert A\mathbf{x} - \mathbf{b}\Vert.\]</span></p>
<p>That is, <span class="math inline">\(\mathbf{\hat{x}}\)</span> is the least-squares solution of <span class="math inline">\(A\mathbf{x} = \mathbf{b}\)</span>.</p>
</div>
</section>
<section id="when-the-normal-equations-have-multiple-solutions" class="level3">
<h3 class="anchored" data-anchor-id="when-the-normal-equations-have-multiple-solutions">When the Normal Equations have Multiple Solutions</h3>
<p>We have seen that the normal equations <strong>always</strong> have a solution.</p>
<p>Is there always a <strong>unique</strong> solution?</p>
<div class="fragment">
<p>No, there can be multiple solutions that <strong>all</strong> minimize <span class="math inline">\(\Vert A\mathbf{x} - \mathbf{b}\Vert.\)</span></p>
</div>
<div class="fragment">
<p>Let’s remind ourselves of what is going on when a linear system has multiple solutions.</p>
<p>We know that a linear system has multiple solutions when there are columns that are not pivot columns.</p>
</div>
<div class="fragment">
<p>Equivalently, when <span class="math inline">\(A\hat{\mathbf{x}} = \hat{\mathbf{b}}\)</span> has multiple solutions, the columns of <span class="math inline">\(A\)</span> are linearly dependent.</p>
<p>Here is a picture of what is going on. In this case, <span class="math inline">\(A\)</span> is <span class="math inline">\(3 \times 3\)</span>.</p>
<p>But note, that <span class="math inline">\(\operatorname{Col}A\)</span> is only two-dimensional because the three columns are linearly dependent.</p>
<div class="ctrd">
<div id="ae0a69e3" class="cell" data-execution_count="13">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="L22LeastSquares_files/figure-html/cell-14-output-1.png" width="477" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><strong>Example.</strong></p>
<p>Find a least-squares solution for <span class="math inline">\(A\mathbf{x} = \mathbf{b}\)</span> for</p>
<p><span class="math display">\[A = \begin{bmatrix}1&amp;1&amp;0&amp;0\\1&amp;1&amp;0&amp;0\\1&amp;0&amp;1&amp;0\\1&amp;0&amp;1&amp;0\\1&amp;0&amp;0&amp;1\\1&amp;0&amp;0&amp;1\end{bmatrix},\;\;\; \mathbf{b} = \begin{bmatrix}-3\\-1\\0\\2\\5\\1\end{bmatrix}.\]</span></p>
<div class="fragment">
<p><strong>Solution.</strong> Compute</p>
<p><span class="math display">\[A^TA = \begin{bmatrix}1&amp;1&amp;1&amp;1&amp;1&amp;1\\1&amp;1&amp;0&amp;0&amp;0&amp;0\\0&amp;0&amp;1&amp;1&amp;0&amp;0\\0&amp;0&amp;0&amp;0&amp;1&amp;1\end{bmatrix}\begin{bmatrix}1&amp;1&amp;0&amp;0\\1&amp;1&amp;0&amp;0\\1&amp;0&amp;1&amp;0\\1&amp;0&amp;1&amp;0\\1&amp;0&amp;0&amp;1\\1&amp;0&amp;0&amp;1\end{bmatrix} = \begin{bmatrix}6&amp;2&amp;2&amp;2\\2&amp;2&amp;0&amp;0\\2&amp;0&amp;2&amp;0\\2&amp;0&amp;0&amp;2\end{bmatrix}\]</span></p>
<p><span class="math display">\[A^T\mathbf{b} = \begin{bmatrix}1&amp;1&amp;1&amp;1&amp;1&amp;1\\1&amp;1&amp;0&amp;0&amp;0&amp;0\\0&amp;0&amp;1&amp;1&amp;0&amp;0\\0&amp;0&amp;0&amp;0&amp;1&amp;1\end{bmatrix}\begin{bmatrix}-3\\-1\\0\\2\\5\\1\end{bmatrix} = \begin{bmatrix}4\\-4\\2\\6\end{bmatrix}\]</span></p>
</div>
<div class="fragment">
<p>To solve <span class="math inline">\(A^TA\hat{\mathbf{x}} = A^T\mathbf{b},\)</span> we’ll use row reduction. The augmented matrix <span class="math inline">\([A^TA\; A^T\mathbf{b}]\)</span> is:</p>
<p><span class="math display">\[\begin{bmatrix}6&amp;2&amp;2&amp;2&amp;4\\2&amp;2&amp;0&amp;0&amp;-4\\2&amp;0&amp;2&amp;0&amp;2\\2&amp;0&amp;0&amp;2&amp;6\end{bmatrix} \sim \begin{bmatrix}1&amp;0&amp;0&amp;1&amp;3\\0&amp;1&amp;0&amp;-1&amp;-5\\0&amp;0&amp;1&amp;-1&amp;-2\\0&amp;0&amp;0&amp;0&amp;0\end{bmatrix}\]</span></p>
</div>
<div class="fragment">
<p>Since there is a column without a pivot, we know the columns of <span class="math inline">\(A^TA\)</span> are linearly dependent.</p>
<p>This happens because the columns of <span class="math inline">\(A\)</span> are linearly dependent.</p>
<p>You can see this as follows: if <span class="math inline">\(A\)</span> has a non-trivial null space, then <span class="math inline">\(A^TA\)</span> also has a nontrival null space.</p>
</div>
<div class="fragment">
<p>So there is a free variable.</p>
<p>The general solution is then <span class="math inline">\(x_1 = 3-x_4\)</span>, <span class="math inline">\(x_2 = -5+x_4\)</span>, <span class="math inline">\(x_3 = -2 + x_4\)</span>, and <span class="math inline">\(x_4\)</span> is free.</p>
<p>So the general least-squares solution of <span class="math inline">\(A\hat{\mathbf{x}} = \mathbf{b}\)</span> has the form</p>
<p><span class="math display">\[\mathbf{\hat{x}} = \begin{bmatrix}3\\-5\\-2\\0\end{bmatrix} + x_4\begin{bmatrix}-1\\1\\1\\1\end{bmatrix}\]</span></p>
</div>
<div class="fragment">
<p>Keep in mind that the orthogonal projection <span class="math inline">\(\hat{\mathbf{b}}\)</span> is always unique.</p>
<p>The reason that there are multiple solutions to this least squares problem is that there are <strong>multiple ways</strong> to construct <span class="math inline">\(\hat{\mathbf{b}}\)</span>.</p>
<p>The reason that there are multiple ways to construct <span class="math inline">\(\hat{\mathbf{b}}\)</span> is that the columns of <span class="math inline">\(A\)</span> are linearly dependent, so <strong>any</strong> vector in the column space of <span class="math inline">\(A\)</span> can be constructed in multiple ways.</p>
</div>
<div class="fragment">
<p>Here is a theorem that allows use to identify when there are multiple least-squares solutions.</p>
</div>
<p><strong>Theorem.</strong> Let <span class="math inline">\(A\)</span> be an <span class="math inline">\(m\times n\)</span> matrix. The following statements are equivalent:</p>
<p>&nbsp; 1. The equation <span class="math inline">\(A\mathbf{x} = \mathbf{b}\)</span> has a unique least-squares solution for each <span class="math inline">\(\mathbf{b}\)</span> in <span class="math inline">\(\mathbb{R}^m.\)</span></p>
<p>&nbsp; 2. The columns of <span class="math inline">\(A\)</span> are linearly independent.</p>
<p>&nbsp; 3. The matrix <span class="math inline">\(A^TA\)</span> is invertible.</p>
<p>When these statements are true, the least-squares solution <span class="math inline">\(\mathbf{\hat{x}}\)</span> is given by:</p>
<p><span class="math display">\[\mathbf{\hat{x}} = (A^TA)^{-1}A^T\mathbf{b}\]</span></p>
</section>
<section id="projection-onto-an-abitrary-basis" class="level3">
<h3 class="anchored" data-anchor-id="projection-onto-an-abitrary-basis">Projection onto an Abitrary Basis</h3>
<div class="fragment">
<p>When <span class="math inline">\(A^TA\)</span> is invertible, and <span class="math inline">\(\hat{\mathbf{b}}\)</span> is unique, we can put together the two equations</p>
<p><span class="math display">\[\mathbf{\hat{x}} = (A^TA)^{-1}A^T\mathbf{b}\]</span></p>
<p>and</p>
<p><span class="math display">\[A\mathbf{\hat{x}} = \hat{\mathbf{b}}\]</span></p>
<p>to get:</p>
<p><span class="math display">\[\hat{\mathbf{b}} = A(A^TA)^{-1}A^T\mathbf{b}\]</span></p>
</div>
<div class="fragment">
<p>Let’s stop and look at this from a very general standpoint.</p>
<p>Consider <span class="math inline">\(\mathbf{b}\)</span> to be an arbitrary point, and <span class="math inline">\(A\)</span> to be a matrix whose columns are a basis for a subspace (ie, <span class="math inline">\(\operatorname{Col} A\)</span>).</p>
<p>Then <span class="math inline">\(\hat{\mathbf{b}}\)</span> is the projection of <span class="math inline">\(\mathbf{b}\)</span> onto <span class="math inline">\(\operatorname{Col} A\)</span>.</p>
</div>
<div class="fragment">
<p>Up until now we have seen how to project a point onto a line, or on to a subspace with an orthogonal basis.</p>
<p>But now we see that</p>
<p><span class="math display">\[ \operatorname{proj}_{\operatorname{Col} A} \mathbf{b} = A(A^TA)^{-1}A^T\mathbf{b} \]</span></p>
<p>So we now have an expression for projection onto a subspace given an <strong>arbitrary</strong> basis. This is a general formula that can be very useful!</p>
</div>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>